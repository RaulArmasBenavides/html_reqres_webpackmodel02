<!DOCTYPE html>
<html>

<head>

  <title>DevExtreme Demo</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  
  <title>Domvas!</title>

  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,300' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/main.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>window.jQuery || document.write(decodeURIComponent('%3Cscript src="js/jquery.min.js"%3E%3C/script%3E'))</script>
  <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/21.2.3/css/dx.common.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn3.devexpress.com/jslib/21.2.3/css/dx.light.css" />
  <script src="https://cdn3.devexpress.com/jslib/21.2.3/js/dx.all.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.js"></script>
 
  <link rel="stylesheet" type="text/css" href="css/styles.css" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../css/froala_editor.css">
  <link rel="stylesheet" href="../../css/froala_style.css">
  <link rel="stylesheet" href="../../css/plugins/code_view.css">
  <link rel="stylesheet" href="../../css/plugins/image_manager.css">
  <link rel="stylesheet" href="../../css/plugins/image.css">
  <link rel="stylesheet" href="../../css/plugins/table.css">
  <link rel="stylesheet" href="../../css/plugins/video.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/codemirror.min.css">



  <style type="text/css">

    #dom {
      font-family: Arial;
      border: 5px solid rgba(0,0,0,0.2);
      border-radius: 10px;
      width: 260px;
      padding: 5px 20px;
      background: #4f8eff;

      text-shadow: 1px 1px 0 #264782;
      line-height: 1.4em;

      margin: 20px;
    }

    #dom p {
      color: rgba(255,255,255,0.8);
    }

    #dom strong {
      color: #fff;
      font-style: italic;
    }

  </style>

  <style>
    body {
      text-align: center;
    }

    div#editor {
      width: 81%;
      margin: auto;
      text-align: left;
    }
  </style>
</head>
 

<body>

  <div style='font-size:30px' id="dom">
    <p>EHRMAGERD <strong>DOM IN CANVAS</strong>!</p>
  </div>
  <div id="editor">
    <form>
      <textarea id='edit' style="margin-top: 30px;" placeholder="Type some text">
        <h1>Textarea</h1>
        <p>The editor can also be initialized on a textarea.</p>
        <h1>Hola Mundo</h1>
        <canvas id="test" width="1950" height="600"><canvas>
        
      </textarea>

      <input type="submit">
    </form>

    <button id="demo" class="downloadtable2" onclick="downloadtable2()"> Download Chart</button>
    <button id="demo" class="downloadtable3" onclick="downloadtable3()"> Download Chart3</button>
  </div>

  <div class = "contenedor">
    <div class="demo-container">
      <div id="chart-demo">
        <div id="chart"></div>
        </div>
    </div>
  </div>
 
  

  <script src="https://unpkg.com/simplebar@5.2.1/dist/simplebar.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/codemirror.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.3.0/mode/xml/xml.min.js"></script>
  <script type="text/javascript" src="../../js/froala_editor.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/align.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/code_beautifier.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/code_view.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/draggable.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/image.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/image_manager.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/link.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/lists.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/paragraph_format.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/paragraph_style.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/table.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/video.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/url.min.js"></script>
  <script type="text/javascript" src="../../js/plugins/entities.min.js"></script>

  <script>
    (function () {
      const editorInstance = new FroalaEditor('#edit', {
        enter: FroalaEditor.ENTER_P,
        placeholderText: null,
        events: {
          initialized: function () {
            const editor = this
            this.el.closest('form').addEventListener('submit', function (e) {
              console.log(editor.$oel.val())
              e.preventDefault()
            })
          }
        }
      })
    })()
  </script>
</body>

<script> const complaintsData = [ { complaint: 'Cold pizzda', count: 780 },
  { complaint: 'Not enough cheese', count: 120 },{ complaint: 'Underbaked or Overbaked', count: 52 },
  { complaint: 'Delayed delivery', count: 1123 },{ complaint: 'Damaged pizza', count: 321 },
  { complaint: 'Incorrect billing', count: 89 },{ complaint: 'Wrong size delivered', count: 222 },];
let a ,b ;
  $(() => 
    
    {
    const data = complaintsData.sort((a, b) => b.count - a.count);
    const totalCount = data.reduce((prevValue, item) => prevValue + item.count, 0);
    let cumulativeCount = 0;
    const dataSource = data.map((item) => {
      cumulativeCount += item.count;
      return {
        descripcion: item.complaint,
        count: item.count,
        cumulativePercentage: Math.round((cumulativeCount * 100) / totalCount),
      };
    });
     $('#chart').dxChart({     dataSource,    title: 'Pizza Shop Complaints',    
      valueAxis: [{    name: 'frequency',   position: 'left',   tickInterval: 300,      },
       {       name: 'percentage', position: 'right', showZero: true,        
       label: { customizeText(info) { return `${info.valueText}%`;  },  }, 
        constantLines: [{  value: 80,         color: '#fc3535',dashStyle: 'dash',   width: 2,
         label: { visible: false },}],tickInterval: 20,valueMarginsEnabled: false,}],
         commonSeriesSettings: {   argumentField: 'descripcion',}, series: [{  type: 'bar',valueField: 'count',
       axis: 'frequency',name: 'Complaint frequency',color: '#fac29a',     }, 
       {       type: 'spline',valueField: 'cumulativePercentage',axis: 'percentage',name: 'Porcentaje acumulado',
       color: '#6b71c3',      }],      legend: {        verticalAlignment: 'bottom',
       horizontalAlignment: 'center',     },    });    });
</script>




<script src="js/domvas.js"></script>
<script src="js/domvas.min.js"></script>
<script>
      function downloadtable2() 
      {		
       console.log('intentando dibujar');
       var canvas = document.getElementById("test");
       var context = canvas.getContext('2d');

      domvas.toImage(document.getElementById("demo-container"), function() {
        // Look ma, I just converted this element to an image and can now to funky stuff!
        context.drawImage(this, 400, 400);
      }); 
 }


      function downloadtable3() 
      {
        var node = document.getElementById('chart');


        domtoimage.toPng(node,{ quality: 0.95 })
            .then(function (dataUrl) {
                var img = new Image();
                img.src = dataUrl;
                var canvas = document.getElementById("test");
                var context = canvas.getContext('2d');
                context.fillStyle = "rgb(200,0,0)";
                context.fillRect(40,60,20,20);
                img.onload = function () {
                context.drawImage( img,6,6);
            }
                //downloadURI(dataUrl, "chart.png")
            })
            .catch(function (error) {
                console.error('oops, something went wrong', error);
            });
      }

      //download the file 
      function downloadURI(uri, name) {
          var link = document.createElement("a");
          link.download = name;
          link.href = uri;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          delete link;
      }
</script>
</html>